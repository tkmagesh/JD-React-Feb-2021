<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Tracker</title>
    <style>
        body{
            margin : 50px
        }
        section{
            margin-bottom: 10px;
        }
        .stats, .bugname{
            font-size: 18pt;
        }
        .closed {
            color : red;
            text-decoration: line-through;
            font-style: italic;
            font-weight: bold;
        }
        .bugname{
            cursor : pointer;
        }
        ol{ 
            width : 450px;
            list-style: none;
            -webkit-padding-start : 0px
        }
        .datetime{
            font-style: italic;
        }
        li{
            margin-bottom: 10px;
            border : 1px solid gray;
            padding : 10px;
            border-radius: 5px;
            background-color: #e7e7e7;
        }
    </style>
    <!-- 
        1. Add new bugs
        2. List the added bugs
        3. Toggle the 'closed' status of any bug
        4. Remove any bug
        5. Remove all 'closed' bugs
        6. Display stats
        7. Sort the bugs (Assignment)
        8. Persist the bugs in the server
        9. Make the bugs accessible using unique URLs (routing)
        10. Write tests
        11. Package the application for deployment
     -->
    <script src="state-manager.js"></script>
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src="babel.min.js"></script>
    <script type="text/babel">
        function bugsReducer(currentState = [], action){
            if (action.type === 'ADD_BUG'){
                return [...currentState, action.payload];
            }
            return currentState;
        }

        //To be fixed:
        let currentBugId = 0;

        const bugActionCreators = {
            addNew(newBugName){
                const newBug = {
                    id : ++currentBugId,
                    name : newBugName,
                    isClosed : false,
                    createdAt : new Date()
                };
                const action = { type : 'ADD_BUG', payload : newBug };
                return action;
            }
        }

        const store = StateManager.createStore(bugsReducer);
        const bugActionDispatchers = StateManager.bindActionCreators(bugActionCreators, store.dispatch);

        const BugTracker = ({bugs, addNew, remove = () =>{} }) => {
            const [newBugName, setNewBugName] = React.useState('');
            const bugItems = bugs.map(bug => (
                <li key={bug.id}>
                    <span className="bugname">{bug.name}</span>
                    <div className="datetime">[{bug.createdAt.toString()}]</div>
                    <input type="button" value="Remove" onClick={ () => remove(bug)} />
                </li>
            ))
            return(
                <React.Fragment>
                    <h3>Bugs</h3>
                    <section className="stats">
                        <span className="closed">1</span>
                        <span> / </span>
                        <span>{bugs.length}</span>
                    </section>
                    <section className="edit">
                        <label htmlFor="">Bug Name : </label>
                        <input type="text" onChange={evt => setNewBugName(evt.target.value)}/>
                        <input type="button" value="Add New" onClick={() => addNew(newBugName)} />
                    </section>
                    <section className="sort">
                        <label htmlFor="">Order By :</label>
                        <select>
                            <option value=""></option>
                            <option value=""></option>
                        </select>
                        <label htmlFor="">Descending ? :</label>
                        <input type="checkbox" />
                    </section>
                    <section className="list">
                        <ol>
                            {bugItems}
                            {/* 
                            <li>
                                <span className="bugname closed">[Bug - 2]</span>
                                <div className="datetime">[Created At]</div>
                                <input type="button" value="Remove" />
                            </li> 
                            */}
                        </ol>
                        <input type="button" value="Remove Closed" />
                    </section>
                </React.Fragment>
            )
        }

        function renderApp(){
            const bugs = store.getState();
            ReactDOM.render(
                <BugTracker bugs={bugs} {...bugActionDispatchers}/>
                , document.getElementById('root')
            );
        }
        renderApp();
        store.subscribe(renderApp);
    </script>
</head>
<body>
    <h1>Bug Tracker</h1>
    <hr>
    <div id="root">


    </div>
</body>
</html>